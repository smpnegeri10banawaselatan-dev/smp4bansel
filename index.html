<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Perangkat Pembelajaran</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-4xl mx-auto bg-white shadow-md rounded p-6">
<h1 class="text-2xl font-bold mb-6 text-center">ðŸ“š Perangkat Pembelajaran</h1>

<form id="guruForm" class="space-y-4">
  <input type="text" name="nama_guru" placeholder="Nama Guru" class="w-full border rounded p-2" required>
  <input type="text" name="nip" placeholder="NIP" class="w-full border rounded p-2" required>
  <label class="block">Upload Media Pembelajaran:</label>
  <input type="file" name="file" accept=".pdf,.ppt,.pptx,.doc,.docx,.mp4" required>
  <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Simpan</button>
</form>
<p id="status" class="mt-2 text-green-600 font-bold"></p>

<h2 class="text-lg font-semibold mt-6 mb-2">Daftar Guru & Media</h2>
<table class="w-full border-collapse border border-gray-300">
  <thead>
    <tr class="bg-gray-200">
      <th class="border px-3 py-2">No</th>
      <th class="border px-3 py-2">Nama Guru</th>
      <th class="border px-3 py-2">NIP</th>
      <th class="border px-3 py-2">Media</th>
    </tr>
  </thead>
  <tbody id="dataTable"></tbody>
</table>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxsnSxFUx0hzMiruBkiBm5KWCSnieVegeVVrcealALKYvUByEWUl2I3ssswvGYWW7fd4w/exec";

const form = document.getElementById("guruForm");
const tableBody = document.getElementById("dataTable");
const statusEl = document.getElementById("status");

// Submit form
form.addEventListener("submit", async e=>{
  e.preventDefault();
  const fileInput = e.target.file.files[0];
  const reader = new FileReader();

  reader.onload = async function(){
    const data = {
      nama_guru: e.target.nama_guru.value,
      nip: e.target.nip.value,
      file: reader.result
    };

    try {
      const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: {"Content-Type":"application/json"}
      });
      const result = await res.json();
      if(result.status==="success"){
        statusEl.innerText = "âœ… Upload berhasil!";
        form.reset();
        loadData();
      } else {
        statusEl.innerText = "âŒ Gagal upload: "+result.message;
      }
    } catch(err){
      statusEl.innerText = "âš ï¸ Error koneksi!";
    }
  };

  reader.readAsDataURL(fileInput);
});

// Load data dari Spreadsheet
async function loadData(){
  try {
    const res = await fetch(scriptURL);
    const data = await res.json();
    tableBody.innerHTML = "";
    data.forEach((row,i)=>{
      tableBody.innerHTML += `
        <tr>
          <td class="border px-3 py-2">${i+1}</td>
          <td class="border px-3 py-2">${row["Nama Guru"]}</td>
          <td class="border px-3 py-2">${row["NIP"]}</td>
          <td class="border px-3 py-2"><a href="${row["Link Media Pembelajaran"]}" target="_blank" class="text-blue-600 underline">Lihat</a></td>
        </tr>
      `;
    });
  } catch(err){ console.log(err); }
}

loadData();
</script>
</body>
</html>
